<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/reset.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/animate.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css" media="screen" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="highlight/styles/zenburn.css">
    <script src="highlight/highlight.pack.js"></script>
    <title>Get started - Suki</title>
  </head>

  <body>
    <header>
      <div class="doc">
        <p class="back"><a href="index.html">&lt; Back</a></p>
        <h1>入门</h1>
        <h2>5 分钟开发一个 RESTful API</h2>
        <hr>
        <p class="preface">在本篇教程中，我们将学会如何使用 Suki 框架开发一个 RESTful API 应用。</p>
        <h3>0. 定义 API</h3>
        <p>这个 API 提供了图书管理接口，具体如下：</p>
        <div class="content">
          <table>
            <thead>
              <tr>
                <th>方法</th>
                <th>URL</th>
                <th>描述</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>GET</td>
                <td>/books</td>
                <td>获取所有的书</td>
              </tr>
              <tr>
                <td>POST</td>
                <td>/books</td>
                <td>创建一本书</td>
              </tr>
              <tr>
                <td>GET</td>
                <td>/books/:bookId</td>
                <td>获取指定的书</td>
              </tr>
              <tr>
                <td>PUT</td>
                <td>/books/:bookId</td>
                <td>修改指定的书</td>
              </tr>
              <tr>
                <td>DELETE</td>
                <td>/books/:bookId</td>
                <td>删除指定的书</td>
              </tr>
          </table>
        </div>
        <h3>1. 安装 Suki</h3>
        <p>Suki 框架提供了一个实用的命令 <code class="inline">suki</code>，使用如下命令安装，就可以在任何地方调用这个命令了：</p>
        <pre><code>$ npm install -g suki</code></pre>
        <h3>2. 创建一个应用</h3>
        <p>我们要做的第一件事就是创建一个 Suki 应用，使用 <code class="inline">suki new</code> 命令可以轻松创建一个应用模板：</p>
        <pre><code>$ suki new book</code></pre>
        <p>其中 <code class="inline">book</code> 是应用的名称。</p>
        <p>命令执行后，Suki 会在当前目录中建立一个名为 "book" 的目录，这就是我们应用的根目录。</p>
        <h3>3. 定义模型（Model）</h3>
        <p>Suki 遵循 MVC 模式，并使用 <a href="http://sequelizejs.com">Sequelize</a> 库作为模型层</p>
        <p>现在我们执行以下命令建立一个 book 模型：</p>
        <pre><code>$ suki generate model book</code></pre>
        <p>该命令会在应用根目录下的 app/models 文件夹下建立名为 Book.coffee 的文件，内容如下：</p>
        <pre><code>module.exports = class extends Suki.SequelizeModel

  @_define: (DataTypes) ->
        </code></pre>
        <p>我们为 book 模型定义两个属性，分别为标题（title）和价格（price）：</p>
        <pre><code>module.exports = class extends Suki.SequelizeModel

  @_define: (DataTypes) ->
    title: DataTypes.STRING
    price: DataTypes.INTEGER
        </code></pre>
        <h3>4. 定义控制器（Controller）</h3>
        <p>控制器和路由相关。</p>
        <p>执行如下命令建立一个 book 控制器：</p>
        <pre><code>$ suki generate controller book</code></pre>
        <p>该命令会在应用根目录下的 app/controllers 文件夹下建立名为 Book.coffee 的文件，我们将其内容修改为：</p>
        <pre><code>module.exports = class extends Suki.Controller

  # GET /books
  index: (Book) ->
    @res.json Book.findAll()

  # POST /books
  create: (Book) ->
    @res.json Book.create
      title: @req.body.title
      price: @req.body.price

  # GET /books/:bookId
  show: ->
    @res.json @book

  # PUT /books/:id
  update: ->
    @book.title = req.body.title
    @book.price = req.body.price
    @res.json @book.save()

  # DELETE /books/:id
  destroy: ->
    @book.destroy()
    @res.json { "message": "deleted" }

        </code></pre>
        <p>在 Suki 中，每个控制器都是一个 CoffeeScript 中的 class。每当访问一个 URL 时，Suki 会根据规则找到其对应的控制器，并调用控制器中相应的方法。</p>
        <h3>5. 配置数据库连接</h3>
        <p>将应用根目录下的 config/default.yml 中的 sequelize 修改实际的情况。</p>
      </div>
    </header>
    <a href="https://github.com/luin/Suki"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>
    <script src="javascripts/jquery.js"></script>
    <script src="javascripts/main.js"></script>
  </body>
</html>


